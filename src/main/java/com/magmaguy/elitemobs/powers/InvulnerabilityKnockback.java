package com.magmaguy.elitemobs.powers;

import com.magmaguy.elitemobs.MetadataHandler;
import com.magmaguy.elitemobs.api.EliteMobDamagedEvent;
import com.magmaguy.elitemobs.config.powers.PowersConfig;
import com.magmaguy.elitemobs.mobconstructor.custombosses.CustomBossEntity;
import com.magmaguy.elitemobs.powers.meta.MinorPower;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.scheduler.BukkitRunnable;
import org.bukkit.util.Vector;

/**
 * Created by MagmaGuy on 30/04/2017.
 */
public class InvulnerabilityKnockback extends MinorPower implements Listener {

    public InvulnerabilityKnockback() {
        super(PowersConfig.getPower("invulnerability_knockback.yml"));
    }

    @EventHandler
    public void invulnerabilityKnockback(EliteMobDamagedEvent event) {
        if (event.getEliteEntity().hasPower(this) ||
                event.getEliteEntity() instanceof CustomBossEntity &&
                        ((CustomBossEntity) event.getEliteEntity()).getCustomBossesConfigFields().isFrozen()) {
            if (!event.getEliteEntity().isValid()) return;
            event.getEntity().setVelocity(new Vector(0, 0, 0));
            new BukkitRunnable() {
                @Override
                public void run() {
                    if (!event.getEliteEntity().isValid()) return;
                    event.getEntity().setVelocity(new Vector(0, 0, 0));
                }
            }.runTaskLater(MetadataHandler.PLUGIN, 1);
        }
    }

}

